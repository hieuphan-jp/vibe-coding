import requests

url = "https://qldt.hust.edu.vn/soicteducationstudent/data"

cookie_str = "JSESSIONID=...; soict-session-id=...; x-student-portal-token=..."  # copy từ Headers

headers = {
    "Content-Type": "text/x-gwt-rpc; charset=UTF-8",
    "Origin": "https://qldt.hust.edu.vn",
    "Referer": "https://qldt.hust.edu.vn/student",
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36",
    "Cookie": cookie_str,
    "x-gwt-module-base": "https://qldt.hust.edu.vn/soicteducationstudent/",
    "x-gwt-permutation": "B1CFA64795873827CD1A5154B6FFA6EC"  # copy từ Headers trong DevTools
}

def make_payload(ma_lop: str):
    return f"""7|0|10|https://qldt.hust.edu.vn/soicteducationstudent/|69D0C558D6E9F3D651611A944C1B2ADA|com.soict.edu.core.client.service.DataService|searchClasses|java.lang.String/2004016611|java.lang.Long/4227064769|java.util.List|20251|java.util.Arrays$ArrayList/2507071751|{ma_lop}|1|2|3|4|4|5|6|6|7|8|6|WJnseAAAB|6|P__________|9|1|5|10|"""

def find_gv(ma_lop):
    payload = make_payload(ma_lop)
    response = requests.post(url, headers=headers, data=payload)
    str = response.text
    return name(str)

import re

def name(text):
    pattern = r'[\w\.-]+@hust\.edu\.vn'
    emails = re.search(pattern, text)
    if emails == None:
        return ""
    return "email:{}".format(emails.group())
    
# ma = [161345,161348,161349,161357,161366,161367,161368,161369,161370,161371,161372,161373,161374,161375,161376,161380,161381,161382,161383,161384,161385,161396,161397,161398,161399,161538,161629,162059,162281,162282,162285,162286,162287,162288,162289,162409,162410,164485,164486,164487,164488,164489,164490,164491,164492,164493,164494,164495,164496,164497,164498,164499,164500,164501,164502,164503,164504,164505,164506,164507,164508,164509,164510,164511,164512,164513,164514,164515,164516,164517,164518,164519,164520,164521,164522,164523,164524,164525,164526,164527,164528,164529,164530,164531,164532,164533,164534,164535,164536,164537,164538,164539,164540,164541,164542,164543,164544,164545,164546,164547,164548,164549,164550,164551,164552,164553,164554,164555,164556,164557,164558,164559,164560,164561,164562,164563,164564,164565,164566,164567,164568,164569,164570,164571,164572,164573,164574,164575,164576,164577,164578,164579,164580,164581,164582,164583,164584,164585,164586,164587,164588,164589,164590,164591,164592,164593,164594,164595,164596]
ma = ["161345","161348","161349","161357","161366","161367","161368","161369","161370","161371","161372","161373","161374","161375","161376","161380","161381","161382","161383","161384","161385","161396","161397","161398","161399","161538","161629","162059","162281","162282","162285","162286","162287","162288","162289","162409","162410","164485","164486","164487","164488","164489","164490","164491","164492","164493","164494","164495","164496","164497","164498","164499","164500","164501","164502","164503","164504","164505","164506","164507","164508","164509","164510","164511","164512","164513","164514","164515","164516","164517","164518","164519","164520","164521","164522","164523","164524","164525","164526","164527","164528","164529","164530","164531","164532","164533","164534","164535","164536","164537","164538","164539","164540","164541","164542","164543","164544","164545","164546","164547","164548","164549","164550","164551","164552","164553","164554","164555","164556","164557","164558","164559","164560","164561","164562","164563","164564","164565","164566","164567","164568","164569","164570","164571","164572","164573","164574","164575","164576","164577","164578","164579","164580","164581","164582","164583","164584","164585","164586","164587","164588","164589","164590","164591","164592","164593","164594","164595","164596"]
ma2 = ["161380","161381","161382","161383","161384","161385","161396","161538","162282","162285","162286","162287","162289","162409","162410"]
ma3 = ["161323", "161324", "161325", "161474", "162283", "162284", "164859"]
ma4 = ["163229", "163230", "163231", "163232", "163233", "163234", "163235", "163236", "163237", "163530", "163531", "163532", "163702", "163703", "163704", "163705", "163814", "163815", "163816", "163817", "163929"]
ma5 = ["164135","164136","164137","164138","164139","164140","164141","164142","164143","164144","164145","164146","164147","164148","164149","164150","164151","164152","164153","164154","164155","164156","164157","164158","164159","164160","164161","164162","164163","164164","164165","164166"]

with open("demo_caodulieu_ketqua.txt", "w", encoding="utf-8") as f:
    for lop in ma5:
        str = find_gv(lop)
        if str == "":
            continue
        f.write("{}: {}".format(lop, name(str)))
        f.write("\n")

